# 基于UDP的高效可靠传输协议分析

## 需求
### 可靠连接
连接建立之后保证数据传输不丢失、不失序、不重复，为上层应用提供透明可靠传输。
### NAT穿透 保活
提供NAT穿透机制，并利用心跳包来维持连接不断开。
### 加密
传输过程中数据加密。
### 连接复用
同一个connect可以承载来自应用的不同的data stream，相互之间不干扰，减少不必要的连接。  
### 高性能 高带宽低延时
充分利用带宽，尽量低的延迟。并提供机制来平衡带宽和延迟的需求。  
灵活可控的拥塞控制方案，针对不同应用需求可灵活调整。  
connect/stream灵活的流控。  
### 连接迁移
客户端ip或端口变化不会造成当前connect的关闭，不需要重新建立。
### 多链路聚合
来自多条链路(socket)的数据可以聚合处理，充分利用带宽。

## 为什么不用TCP
### 性能
#### 延迟
TCP在以下阶段会带来延迟：
* 建立连接时的多次握手。TCP建立连接采用三次握手机制，一般需要100ms以上。
* 对头阻塞。TCP的连续ARQ累计确认机制会造成前序分组未确认，后续分组全部阻塞，在连接复用场景下会阻塞其他stream。
* 延迟发送。在发送数据量较小时，TCP的nagle算法会要求数据等待一段时间发送。
* 延迟确认。延迟确认会使得接收端接收到分组数据后等待一段时间发送ACK，以实现多个ACK消息合并成一个。与延迟发送共同作用下写-写-读操作序列有可能会造成两端进入等待直到ACK延迟超时。
* 慢启动。TCP的慢启动过程受初始窗口大小影响会照成一定的延迟，不能充分利用带宽。
* 端口耗尽问题。TCP连接关闭再TIME_WAIT状态下会等待2MSL时间，这段时间里端口不可用。
#### 带宽
TCP基于丢包的拥塞控制算法在高带宽高延迟网路中无法充分利用带宽。
### 拥塞控制


## 相关开源方案
### KCP
### QUIC